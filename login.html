import React from 'react';
import ReactDOM from 'react-dom';
import './index.css';
import { GoogleLogin } from 'react-google-login';

function onSignIn(googleUser) {
	console.log("User signed in.");
	let profile = googleUser.getBasicProfile();
	var xhr = new XMLHttpRequest();
	xhr.withCredentials = true;
	xhr.open("POST", "http://battleforcharity.com/create-user", true);
	xhr.setRequestHeader('Content-Type', 'application/json');
	xhr.send(JSON.stringify({
		name: profile.getName(),
		email: profile.getEmail(),
		profile_id: profile.getId(),
		hd: googleUser.getHostedDomain()
	}));
	xhr.onreadystatechange = function() {
		if (xhr.readyState === XMLHttpRequest.DONE) {
			console.log("redirecting...")
			window.location.reload(true);
		}
	}
}

function onFailedSignIn(args) {
	console.log("Google login failed.");
}

class App extends React.Component {
	render() {
		return (
			<div className="everything">
				<div className="loginTitle">Battle For Charity</div>
				<div className="description">Sign in to make your bracket</div>
				<div className="googleButton">
					<GoogleLogin classname="googleButton" clientId="360968735809-85smlnpttakq9ql1ij9mmijibc3q24dq.apps.googleusercontent.com" onSuccess={onSignIn} onFailure={onFailedSignIn} theme="dark"/>
				</div>
			</div>
		)
	}
}

ReactDOM.render(<App/>, document.getElementById('root'));

// If you want your app to work offline and load faster, you can change
// unregister() to register() below. Note this comes with some pitfalls.
// Learn more about service workers: https://bit.ly/CRA-PWA
//serviceWorker.unregister();
